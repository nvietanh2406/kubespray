#1. Install Longhorn
helm install longhorn longhorn -f longhorn/values.yaml --namespace longhorn-system --create-namespace
# Longhorn user: datxadmin / eddde262-b4a5-4a20-8bdb-3b7f0984c836

#2. Install ArgoCD
helm install argocd argocd -f argocd/values.yaml --namespace argocd --create-namespace
#ArgoCD user: admin / 6dea16e5-a9e3-4d1e-9d1a-c4a984fea37e

# Create argocd new app
argocd login 10.0.1.55:30080 --username admin --password 6dea16e5-a9e3-4d1e-9d1a-c4a984fea37e --insecure
argocd repo add https://git.datx.com.vn/datx-k8s/k8s-intervpc.git --username argocd --password "973ecae2-a9c2-4cfe-9e29-730366fd4517" --insecure-skip-server-verification

kubectl create -f - <<EOF
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd-apps
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    name: ''
    namespace: argocd
    server: 'https://kubernetes.default.svc'
  source:
    path: helm-charts/argocd-apps
    repoURL: 'https://git.datx.com.vn/datx-k8s/k8s-intervpc.git'
    targetRevision: hoangcau
  sources: []
  project: default
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - PruneLast=true
      - Replace=true
    retry:
      limit: 2
      backoff:
        duration: 5s
        maxDuration: 3m0s
        factor: 2
EOF